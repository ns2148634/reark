<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>會員專區</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:sans-serif;margin:0;padding:8vw;background:#fafafa;}
    .container{max-width:500px;margin:0 auto;}
    .card{background:#fff;padding:7vw;border-radius:6vw;box-shadow:0 2vw 5vw #0002;margin-top:10vw;}
    .btn{margin-top:4vw;padding:3vw 0vw;border:none;border-radius:3vw;width:100%;font-size:5vw;background:#4caf50;color:#fff;}
    label{display:block;}
    .info{margin:5vw 0;}
  </style>
</head>
<body>
  <div class="container">
    <div id="loading">方舟會員系統載入中...</div>
    <div id="memberArea" style="display:none"></div>
    <div id="registerArea" style="display:none">
      <%== include('register') %>
    </div>
  </div>
  <script>
    async function main(){
      await liff.init({ liffId: '2008128192-ANzL1oyW' });
      if(!liff.isLoggedIn()){ liff.login(); return; }
      const profile = await liff.getProfile();
      const lineID = profile.userId;
      google.script.run.withSuccessHandler(function(data){
        document.getElementById('loading').style.display = 'none';
        if(data){
          showMemberData(data);
        }else{
          document.getElementById('registerArea').style.display = '';
          document.getElementById('reg_lineID').value = lineID;
        }
      }).checkMember(lineID);
    }
    function showMemberData(data){
      let html = `<div class="card"><h2>會員資料</h2><div class="info">`;
      html += `姓名：${data.name}<br/>身份證字號：${data.idNumber}<br/>生日：${data.birthday}<br/>性別：${data.gender}<br/>手機：${data.phone}<br/>地址：${data.city}${data.district}${data.address}<br/>註冊據點：${data.site}`;
      html += `</div></div>`;
      document.getElementById('memberArea').innerHTML = html;
      document.getElementById('memberArea').style.display = '';
    }
    window.onload = main;
  </script>
</body>
</html>
