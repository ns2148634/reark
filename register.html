<div class="card">
  <h2>註冊會員</h2>
  <form id="regForm" onsubmit="return submitReg(this)">
    <input type="hidden" id="reg_lineID" name="lineID"/>
    <label>姓名<input name="name" required maxlength="10" style="width:100%"></label>
    <label>身份證字號<input name="idNumber" required maxlength="10" pattern="[A-Z][0-9]{9}" style="width:100%"></label>
    <label>生日<input name="birthday" type="date" required style="width:100%"></label>
    <label>性別
      <select name="gender" required style="width:100%">
        <option value="">請選擇</option>
        <option value="男">男</option>
        <option value="女">女</option>
      </select>
    </label>
    <label>手機號碼<input name="phone" required pattern="09\d{8}" maxlength="10" style="width:100%"></label>
    <label>居住城市
      <select id="city" name="city" required style="width:100%" onchange="renderDistricts()">
        <option>台北市</option>
        <option>新北市</option>
        <option>桃園市</option>
        <option>台中市</option>
        <option>台南市</option>
        <option>高雄市</option>
        <!-- 可擴充其他城市 -->
      </select>
    </label>
    <label>行政區
      <select id="district" name="district" required style="width:100%"></select>
    </label>
    <label>詳細住址<input name="address" maxlength="30" style="width:100%"></label>
    <label>註冊據點
      <select name="site" required style="width:100%">
        <option>台北富豪</option>
      </select>
    </label>
    <button class="btn" type="submit">送出註冊資料</button>
  </form>
</div>
<script>
const districts = {
  '台北市': ['中正區','大同區','中山區','松山區','大安區','萬華區','信義區','士林區','北投區','內湖區','南港區','文山區'],
  '新北市': ['板橋區','三重區','中和區','永和區','新莊區','新店區','樹林區','鶯歌區','三峽區','淡水區','汐止區','瑞芳區','土城區','蘆洲區','五股區','泰山區','林口區','深坑區','石碇區','坪林區','三芝區','石門區','八里區','平溪區','雙溪區','貢寮區','金山區','萬里區','烏來區'],
  '桃園市': ['桃園區','中壢區','平鎮區','八德區','楊梅區','蘆竹區','大溪區','龍潭區','龜山區','大園區','觀音區','新屋區','復興區'],
  '台中市': ['中區','東區','南區','西區','北區','北屯區','西屯區','南屯區','太平區','大里區','霧峰區','烏日區','豐原區','后里區','石岡區','東勢區','和平區','新社區','潭子區','大雅區','神岡區','大肚區','沙鹿區','龍井區','梧棲區','清水區','大甲區','外埔區','大安區'],
  '台南市': ['中西區','東區','南區','北區','安平區','安南區','永康區','歸仁區','新化區','左鎮區','玉井區','楠西區','南化區','仁德區','關廟區','龍崎區','官田區','麻豆區','佳里區','西港區','七股區','將軍區','學甲區','北門區','新營區','後壁區','白河區','東山區','六甲區','下營區','柳營區','鹽水區','善化區','大內區','山上區','新市區','安定區'],
  '高雄市': ['新興區','前金區','苓雅區','鹽埕區','鼓山區','旗津區','前鎮區','三民區','楠梓區','小港區','左營區','仁武區','大社區','岡山區','路竹區','阿蓮區','田寮區','燕巢區','橋頭區','梓官區','彌陀區','永安區','湖內區','鳳山區','大寮區','林園區','鳥松區','大樹區','旗山區','美濃區','六龜區','甲仙區','杉林區','內門區','茂林區','桃源區','那瑪夏區']
};
function renderDistricts(){
  const city = document.getElementById('city').value;
  const distSel = document.getElementById('district');
  distSel.innerHTML = '';
  (districts[city]).forEach(function(d){
    let opt = document.createElement('option');
    opt.textContent = d; distSel.appendChild(opt);
  });
}
document.getElementById('city').addEventListener('change', renderDistricts);
window.onload = renderDistricts;

// 表單送出
function submitReg(form){
  const obj = Object.fromEntries(new FormData(form).entries());
  google.script.run.withSuccessHandler(function(ret){
    if(ret.success){
      alert('註冊成功！');
      location.reload();
    }else{
      alert('此LINE帳號已註冊，請直接進入會員專區');
      location.reload();
    }
  }).registerMember(obj);
  return false;
}
</script>
